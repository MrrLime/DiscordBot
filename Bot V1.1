# this is a python file
import discord
import json
import urllib
from discord.ext import commands
from urllib import request
from datetime import datetime as dt
from random import randint as r
from keep_alive import keep_alive as ka


insult_list = []
insult_path = 'Insults.txt'

state_list = "states.txt"
state_short_list = "states_short.txt"

colours = [0x0000FF, 0x800000, 0x00FFFF, 0x808080, 0x008000, 0x00FF00,0xFF00FF, 0x000080, 0xFF6600, 0xFF00FF, 0x800080, 0xFF0000, 0xC0C0C0, 0xFFFFFF, 0xFFFF00]

states = []
states_short = []

date_today = dt.today().strftime('%d-%m-%y')

api_raw_dis = "https://api.corona-zahlen.org/districts"
api_raw_ger = "https://api.corona-zahlen.org/germany"
api_raw_sta = "https://api.corona-zahlen.org/states"


# fills the lists(states and states_short), defined at the top
with open(state_list, "r") as file:
    for line in file.readlines():
        states.append(line.strip("\n"))

with open(state_short_list, "r") as file:
    for line in file.readlines():
        states_short.append(line.strip("\n"))
insult_list = []
insult_path = 'Insults.txt'
# ("[~] Input listpath: ")

bot = commands.Bot(command_prefix="I.")

@bot.event
async def on_ready():
    print("ready")
    bot.loop.create_task(status_task())

async def status_task():
    while True:
        await bot.change_presence(activity=discord.Game("on hardcore mode"), status=discord.Status.online)


@bot.command(name="corona")
async def corona(ctx):
    index_colour = r(0,15)
    colour = colours[index_colour]
    # check for later wait_for commands
    def check(m):
        return m.author == ctx.author
    
    value = "Berlin \n Bayern \n Niedersachsen \n Baden-Württemberg \n Rheinland-Pfalz    \n Sachsen \n Thüringen \n Hessen \n Nordrhein-Westfalen \n Sachsen-Anhalt \n     Brandenburg \n Mecklenburg-Vorpommern \n Hamburg \n Schleswig-Holstein \n Saarland   \n Bremen"
    embed = discord.Embed(title="Bundesländer", url="https://github.com/MrrLime/DiscordBot", description="Alle 16 Bundesländer und deren Rechtschreibung.", color=colour)
    embed.thumbnail("url=https://replit.com/@rexy27t/BotCollection#districts-legend.png")
    embed.add_field(name="Bitte gib das gewünschte Bundesland ein.", value=value, inline=False)
    embed.set_footer(text="®MrrLime")
    await ctx.send(embed=embed)
    try:
        message = await bot.wait_for("message", check=check, timeout=20)
    except TimeoutError:
        await ctx.send(":Timeout:")
    else:
        index = states.index(message.content)
        state_short = states_short[index]
        with urllib.request.urlopen(api_raw_ger) as api_fetched:
            msg_ger = str(round(json.loads(api_fetched.read())['weekIncidence']))
        with urllib.request.urlopen(api_raw_sta) as api_fetched:
            msg_sta = str(round(json.loads(api_fetched.read())['data'][state_short]['weekIncidence']))
        if state_short == "BY":
            with request.urlopen(api_raw_dis) as api_fetched:
                msg_dis = str(round(json.loads(api_fetched.read())['data']['09677']['weekIncidence']))
        embed = discord.Embed(title="Inzidenzen", url="https://github.com/MrrLime/DiscordBot", description="Inzidenzen für ganz Deutschland", color=colour)
        embed.add_field(name="Inzidenz Deutschland: ", value=msg_ger, inline=False)
        embed.add_field(name=f"Inzidenz {message.content}: ", value=msg_sta, inline=False)
        if state_short == "BY":
            embed.add_field(name="Inzidenz Main-Spessart:", value=msg_dis, inline=False)
        embed.set_footer(text="®MrrLime")
        await ctx.send(embed=embed)



@bot.command(name = "Insult")
async def on_message(ctx):
    with open(insult_path, "r") as file:
        index = r(0, 190)
        for line in file.readlines():
            insult_list.append(line.strip("\n"))
    def check(m):
        return m.author == ctx.author
    await ctx.send("Wie heist du?")
    try:
        message = await bot.wait_for("message", check=check, timeout=20)
    except TimeoutError:
        await ctx.send(":Timeout:")
    else:
        await ctx.send(f"{message.content}, {insult_list[index].lower()}")

ka()

bot.run("OTIzMzIxNjM1OTcxNDEyMDQw.YcOUSA.s2Mxkh3xymffxI2PAYpO6Zc5KM8")
